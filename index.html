<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ä¸ƒå¤•é’è›™çš„é’è›™ï½œã€Šå­¤å¯¡ã€‹</title>
  <meta name="description" content="ä¼šçœ¨çœ¼ã€ä¼šâ€œå‘±å‘±â€è¯´è¯ã€æœˆäº®å½©è›‹ã€ç‚¹å‡»è®¡æ•°ä¸çˆ±å¿ƒç‰¹æ•ˆçš„ä¸ƒå¤•é’è›™å°é¡µé¢ã€‚">
  <style>
    :root{
      --bg1:#0b132b; --bg2:#1c2541; --bg3:#3a506b;
      --moon:#ffe8a3; --lantern:#ffb3a7; --lantern-deep:#ff8e7a;
      --frog:#47c97d; --frog-deep:#2fab66; --belly:#caf5d9; --cheek:#ff9fb3;
      --leaf:#2b8a3e; --leaf-deep:#1f6f31;
      --bubble:#ffffff; --text:#0b132b; --heart:#ff5c8a;
      --glow: 0 0 10px rgba(255,255,255,.25);
      --glass: rgba(255,255,255,.1);
      --glass-2: rgba(255,255,255,.2);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; color:#fff; font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Noto Sans SC",sans-serif;
      background:
        radial-gradient(1400px 900px at 75% -10%, rgba(255,255,255,.08), transparent 60%),
        conic-gradient(from 180deg at 50% -20%, #1a2a44, #1f3151, #253a60, #1f3151),
        linear-gradient(180deg, var(--bg1), var(--bg2) 55%, var(--bg3));
      overflow:hidden;
    }
    .wrap{ position:relative; height:100%; display:grid; place-items:center; padding:24px; }
    h1{
      position:absolute; top:16px; left:50%; transform:translateX(-50%);
      margin:0; font-weight:900; letter-spacing:.06em; text-shadow:var(--glow);
      font-size:clamp(18px, 2.4vw, 28px);
    }

    /* é¡¶éƒ¨ä¿¡æ¯æ¡ï¼ˆè®¡æ•°ï¼‰ */
    .info{
      position:absolute; top:60px; left:50%; transform:translateX(-50%);
      display:flex; align-items:center; gap:12px;
      padding:8px 14px; border-radius:999px; backdrop-filter: blur(10px);
      background: var(--glass); border:1px solid #ffffff3a; box-shadow: 0 10px 24px rgba(0,0,0,.25);
      font-weight:700;
    }
    .badge{
      min-width:2.2em; text-align:center; padding:.2em .6em; border-radius:999px;
      background: var(--glass-2); border:1px solid #ffffff44; box-shadow: inset 0 0 12px rgba(255,255,255,.12);
      transition: transform .2s ease;
    }
    .badge.bump{ transform: scale(1.14); }

    /* å¤©ç©ºå…ƒç´ ï¼šæ˜Ÿæ˜Ÿã€æœˆäº®ã€ç¯ç¬¼ */
    .sky{position:absolute; inset:0; pointer-events:none;}
    .stars{position:absolute; inset:0; background:
      radial-gradient(2px 2px at 10% 20%, #fff8, transparent 40%),
      radial-gradient(1.5px 1.5px at 30% 60%, #fff6, transparent 40%),
      radial-gradient(1.8px 1.8px at 80% 30%, #fffc, transparent 40%),
      radial-gradient(1.2px 1.2px at 60% 15%, #fff8, transparent 40%),
      radial-gradient(1.5px 1.5px at 50% 75%, #fff6, transparent 40%);
      filter:drop-shadow(0 0 6px #fff6); animation: twinkle 6s linear infinite;
    }
    @keyframes twinkle{ 0%,100%{opacity:.9} 50%{opacity:.6} }

    /* æœˆäº®ï¼šå¯ç‚¹å‡»ï¼Œå½©è›‹åˆ‡çˆ±å¿ƒ */
    .moon{
      position:absolute; top:40px; right:48px; width:96px; height:96px; border-radius:50%;
      background: radial-gradient(circle at 30% 35%, #fff, var(--moon) 45%, #f6d97a 70%, transparent 72%);
      box-shadow: 0 0 40px #ffd; transform:rotate(-6deg); transition: .35s ease;
      cursor:pointer; pointer-events:auto; /* èƒ½ç‚¹å‡» */
    }
    .moon.heart{
      width:96px; height:86px; background: var(--heart); border-radius:12px;
      transform: rotate(-45deg) scale(1.05);
      box-shadow: 0 0 30px #ff9db9, 0 0 60px #ff9db955;
    }
    .moon.heart::before, .moon.heart::after{
      content:""; position:absolute; width:96px; height:96px; border-radius:50%; background: var(--heart);
    }
    .moon.heart::before{ left:-26px; top:-2px }
    .moon.heart::after{ left:26px; top:-2px }

    .lantern{
      position:absolute; top:70px; left:48px; width:44px; height:56px; border-radius:20px;
      background: radial-gradient(ellipse at 50% 40%, #fff8, transparent 60%),
                  linear-gradient(180deg, var(--lantern), var(--lantern-deep));
      box-shadow: 0 6px 16px rgba(0,0,0,.35), 0 0 16px #ffb7a7aa;
      animation: sway 3s ease-in-out infinite;
    }
    .lantern:before,.lantern:after{
      content:""; position:absolute; left:50%; transform:translateX(-50%);
      width:28px; height:2px; background:#ef805f;
    }
    .lantern:before{ top:10px } .lantern:after{ bottom:10px }
    .lantern .line{ position:absolute; top:-40px; left:50%; width:2px; height:40px; background:#ddd; transform:translateX(-50%)}
    @keyframes sway{ 0%,100%{ transform:rotate(-3deg) translateY(0)} 50%{ transform:rotate(3deg) translateY(2px)} }

    /* åœ°é¢ä¸æ°´æ³¢ */
    .pond{ position:absolute; bottom:-120px; left:50%; transform:translateX(-50%);
      width:min(1000px, 90vw); height:420px; border-radius:50%;
      background: radial-gradient(ellipse at 50% 30%, #2d6a9f, #1c3f62 60%, #142b45); filter: blur(2px);
    }
    .ripples{ position:absolute; bottom:120px; left:50%; transform:translateX(-50%);
      width:560px; height:120px; border-radius:50%; opacity:.35;
      box-shadow: 0 0 0 2px #80caff55 inset, 0 0 0 18px #5fb8ff22 inset, 0 0 0 34px #5fb8ff11 inset;
      animation: ripple 4s ease-in-out infinite;
    }
    @keyframes ripple{ 0%,100%{ transform:translateX(-50%) scaleX(1)} 50%{ transform:translateX(-50%) scaleX(1.06)} }

    /* çˆ±å¿ƒç²’å­ */
    .hearts{ position:absolute; inset:0; pointer-events:none; overflow:hidden; }
    .heart{
      position:absolute; width:16px; height:16px; transform: rotate(-45deg);
      background: var(--heart); opacity:0; animation: floatUp 2.8s ease-out forwards;
      box-shadow:0 0 12px #ff7aa96f;
    }
    .heart:before,.heart:after{
      content:""; position:absolute; width:16px; height:16px; border-radius:50%; background: var(--heart);
    }
    .heart:before{ top:-8px; left:0 } .heart:after{ left:8px; top:0 }
    @keyframes floatUp{
      0%{ transform:translateY(0) rotate(-45deg) scale(.7); opacity:.0}
      10%{ opacity:1 }
      100%{ transform:translateY(-180px) rotate(-45deg) scale(1.2); opacity:0}
    }

    /* èˆå°ä¸å¯¹ç™½æ³¡æ³¡ */
    .stage{ position:relative; display:grid; place-items:center; gap:12px; transform:translateY(10px)}
    .bubble{
      position:absolute; top:-40px; left:50%; transform:translate(-50%,-110%) scale(1);
      background: var(--bubble); color:var(--text); padding:10px 14px; border-radius:14px;
      box-shadow: 0 6px 18px rgba(0,0,0,.25); font-weight:800; letter-spacing:.08em; white-space:nowrap;
    }
    .bubble::after{
      content:""; position:absolute; left:50%; bottom:-6px; transform:translateX(-50%) rotate(45deg);
      width:12px; height:12px; background:var(--bubble);
    }
    .bubble[data-talking="true"]{ animation: pop 260ms ease both }
    @keyframes pop{ 0%{ transform:translate(-50%,-110%) scale(.6); opacity:.2} 100%{ transform:translate(-50%,-110%) scale(1); opacity:1} }

    /* æ§ä»¶ */
    .controls{
      position:absolute; bottom:24px; left:50%; transform:translateX(-50%);
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
    }
    .btn{
      appearance:none; border:1px solid #ffffff44; background:linear-gradient(180deg,#ffffff22,#ffffff12);
      color:#fff; padding:10px 16px; border-radius:14px; cursor:pointer; backdrop-filter:blur(6px);
      transition:.2s ease; font-weight:700; letter-spacing:.02em; box-shadow: 0 8px 18px rgba(0,0,0,.25);
    }
    .btn:hover{ background:#ffffff26; transform:translateY(-1px) }
    .btn:active{ transform:translateY(0) scale(.98) }

    /* SVG é’è›™ */
    svg{ display:block }
    .frog{
      filter: drop-shadow(0 18px 24px rgba(0,0,0,.35)); animation: bob 3.5s ease-in-out infinite; cursor:pointer;
    }
    @keyframes bob{ 0%,100%{ transform:translateY(0)} 50%{ transform:translateY(-6px)} }
    .blink > rect{ transform-origin:center; animation: blink 6s infinite; }
    @keyframes blink{ 0%,47%,49%,100%{ transform:scaleY(0) } 48% { transform:scaleY(1) } }
    .talking #mouthOpen{ opacity:1 } #mouthOpen{ opacity:0; transition:.15s } #mouthSmile{ opacity:1 }

    @media (max-width:520px){ .ripples{ width:88vw } .bubble{ font-size:14px } }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸŒ™ ä¸ƒå¤•é’è›™çš„é’è›™ Â· å£åã€Šå­¤å¯¡ã€‹</h1>

    <!-- é¡¶éƒ¨è®¡æ•°ä¿¡æ¯ -->
    <div class="info" aria-live="polite" id="info">
      ğŸ¸ ç‚¹å‡»é’è›™æ¬¡æ•°ï¼š<span class="badge" id="count">0</span>
    </div>

    <!-- å¤©ç©ºä¸è£…é¥° -->
    <div class="sky" aria-hidden="true">
      <div class="stars"></div>
      <div class="moon" id="moon" role="button" title="ç‚¹æˆ‘è¯•è¯•å½©è›‹ï½" aria-label="æœˆäº®å½©è›‹"></div>
      <div class="lantern"><span class="line"></span></div>
    </div>

    <!-- æ°´é¢ä¸æ³¢çº¹ -->
    <div class="pond" aria-hidden="true"></div>
    <div class="ripples" aria-hidden="true"></div>

    <!-- çˆ±å¿ƒç²’å­ -->
    <div class="hearts" id="hearts" aria-hidden="true"></div>

    <!-- èˆå°ï¼šé’è›™ + æ°”æ³¡ -->
    <div class="stage" aria-live="polite">
      <div class="bubble" id="bubble">ã€Šå­¤å¯¡ã€‹</div>

      <!-- SVG é’è›™ï¼ˆå¯ç‚¹å‡»ï¼‰ -->
      <svg id="frog" class="frog" width="360" height="280" viewBox="0 0 360 280" role="img" aria-label="ä¸ƒå¤•é’è›™">
        <defs>
          <radialGradient id="gBelly" cx="50%" cy="45%">
            <stop offset="0%" stop-color="#eafff1"/>
            <stop offset="100%" stop-color="var(--belly)"/>
          </radialGradient>
          <radialGradient id="gBody" cx="40%" cy="40%">
            <stop offset="0%" stop-color="#66e39c"/>
            <stop offset="100%" stop-color="var(--frog)"/>
          </radialGradient>
          <radialGradient id="gLeaf" cx="50%" cy="50%">
            <stop offset="0%" stop-color="#43ad5b"/>
            <stop offset="100%" stop-color="var(--leaf)"/>
          </radialGradient>
        </defs>

        <!-- è·å¶ -->
        <ellipse cx="180" cy="210" rx="120" ry="40" fill="url(#gLeaf)" stroke="var(--leaf-deep)" stroke-width="3"></ellipse>
        <path d="M180 210 L 180 172" stroke="var(--leaf-deep)" stroke-width="3" stroke-linecap="round"></path>

        <!-- èº«ä½“ -->
        <g id="body">
          <ellipse cx="180" cy="150" rx="105" ry="90" fill="url(#gBody)" stroke="var(--frog-deep)" stroke-width="4"></ellipse>
          <ellipse cx="180" cy="175" rx="68" ry="46" fill="url(#gBelly)"></ellipse>
        </g>

        <!-- è„¸é¢Š -->
        <circle cx="125" cy="150" r="12" fill="var(--cheek)" opacity=".6"></circle>
        <circle cx="235" cy="150" r="12" fill="var(--cheek)" opacity=".6"></circle>

        <!-- çœ¼ç› -->
        <g id="eyes">
          <g transform="translate(125,98)">
            <circle r="26" fill="#e8ffe5" stroke="var(--frog-deep)" stroke-width="4"></circle>
            <circle r="10" cx="-2" cy="2" fill="#111"></circle>
            <g class="blink"><rect x="-26" y="-26" width="52" height="52" fill="var(--frog)"></rect></g>
          </g>
          <g transform="translate(235,98)">
            <circle r="26" fill="#e8ffe5" stroke="var(--frog-deep)" stroke-width="4"></circle>
            <circle r="10" cx="2" cy="2" fill="#111"></circle>
            <g class="blink"><rect x="-26" y="-26" width="52" height="52" fill="var(--frog)"></rect></g>
          </g>
        </g>

        <!-- å˜´å·´ -->
        <path id="mouthSmile" d="M140 170 Q 180 190 220 170" fill="transparent" stroke="#1d3b2c" stroke-width="6" stroke-linecap="round"/>
        <ellipse id="mouthOpen" cx="180" cy="176" rx="9" ry="2" fill="#1d3b2c"/>

        <!-- å°æ‰‹ -->
        <path d="M110 190 Q 130 185 140 200" stroke="var(--frog-deep)" stroke-width="6" stroke-linecap="round" fill="none"/>
        <path d="M250 190 Q 230 185 220 200" stroke="var(--frog-deep)" stroke-width="6" stroke-linecap="round" fill="none"/>
      </svg>
    </div>

    <!-- æ§ä»¶ -->
    <div class="controls" aria-label="äº¤äº’æŒ‰é’®">
      <button class="btn" id="btn-talk">è®©é’è›™è¯´ã€Œå‘±ã€</button>
      <button class="btn" id="btn-heart">æ’’çˆ±å¿ƒ</button>
      <button class="btn" id="btn-theme">æ¢é…è‰²</button>
    </div>
  </div>

  <script>
    /* ========== DOM å¼•ç”¨ ========== */
    const $ = s => document.querySelector(s);
    const bubble = $('#bubble');
    const frog = $('#frog');
    const hearts = $('#hearts');
    const btnTalk = $('#btn-talk');
    const btnHeart = $('#btn-heart');
    const btnTheme = $('#btn-theme');
    const moon = $('#moon');
    const countEl = $('#count');
    const infoEl = $('#info');

    /* ========== è®¡æ•°ä¸æ°”æ³¡ ========== */
    let clickCount = 0;
    function updateCount(){
      countEl.textContent = String(clickCount);
      countEl.classList.add('bump');
      setTimeout(()=>countEl.classList.remove('bump'), 220);
    }
    function speak(text="ã€Šå­¤å¯¡ã€‹"){
      bubble.textContent = text;
      bubble.dataset.talking = "true";
      frog.classList.add('talking');
      setTimeout(()=>{ bubble.dataset.talking = "false"; frog.classList.remove('talking'); }, 420);
      const mouth = document.getElementById('mouthOpen');
      mouth.style.opacity = 1;
      setTimeout(()=> mouth.style.opacity = 0, 320);
      spawnHearts(3);
    }

    /* ========== çˆ±å¿ƒç²’å­ ========== */
    function spawnHearts(n=10){
      const rect = frog.getBoundingClientRect();
      const baseX = rect.left + rect.width/2 - 8;
      const baseY = rect.top + rect.height/2;
      for(let i=0;i<n;i++){
        const h = document.createElement('span');
        h.className = 'heart';
        const left = baseX + (Math.random()*120-60);
        const top  = baseY + (Math.random()*30-15);
        const delay = (i * 60 + Math.random()*200) / 1000;
        h.style.left = left + 'px';
        h.style.top = top + 'px';
        h.style.animationDelay = delay + 's';
        hearts.appendChild(h);
        setTimeout(()=> h.remove(), 3500);
      }
    }

     /* ========== WebAudioï¼šæ›´è´´è¿‘â€œå­¤å¯¡â€çš„ä¸¤æ®µå¼äººå£°åˆæˆ ========== */
  let audioCtx = null;
  function ensureAudio(){
    if(!audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if(audioCtx.state === 'suspended'){
      audioCtx.resume();
    }
  }

  // å°å·¥å…·ï¼šåˆ›å»ºä¸€ä¸ªâ€œå…ƒéŸ³â€åˆæˆå™¨ï¼ˆé€šè¿‡ä¸¤æ¡å¹¶è”å¸¦é€šæ»¤æ³¢å™¨åš F1/F2ï¼‰
  function makeVowel(when, {
    f0Start=170, f0End=120, dur=0.22, // åŸºé¢‘ä¸æ—¶é•¿
    F1=400, F2=900,                   // å…±æŒ¯å³°
    gainPeak=0.5, attack=0.02, decay=0.02, release=0.08,
    breath=0.18                       // æ°”å£°æ··å…¥
  }){
    const ctx = audioCtx;

    // å£°æºï¼šè„‰å†²(æ›´æ¥è¿‘å£°é—¨æ³¢) + å°‘é‡é”¯é½¿ï¼Œæ··åˆæ›´åƒäººå£°
    const oscPulse = ctx.createOscillator();
    oscPulse.type = 'square';
    const oscSaw = ctx.createOscillator();
    oscSaw.type = 'sawtooth';

    // è½»å¾®é¢¤éŸ³ LFO
    const lfo = ctx.createOscillator();
    lfo.type = 'sine';
    lfo.frequency.value = 7.5;
    const lfoGain = ctx.createGain();
    lfoGain.gain.value = 2; // Â±2Hz

    // ä¸¤æ¡å¹¶è”å¸¦é€š = F1/F2
    const bp1 = ctx.createBiquadFilter();
    bp1.type = 'bandpass'; bp1.frequency.value = F1; bp1.Q.value = 8;
    const bp2 = ctx.createBiquadFilter();
    bp2.type = 'bandpass'; bp2.frequency.value = F2; bp2.Q.value = 8;

    // è¾“å‡ºå¢ç›Šï¼ˆåŒ…ç»œï¼‰
    const vGain = ctx.createGain(); vGain.gain.value = 0.0001;

    // å°‘é‡â€œæ°”å£°â€
    const noise = ctx.createBufferSource();
    const noiseBuf = ctx.createBuffer(1, Math.floor(ctx.sampleRate*dur), ctx.sampleRate);
    const data = noiseBuf.getChannelData(0);
    for(let i=0;i<data.length;i++){
      // éšæ—¶é—´è¡°å‡ï¼Œé¿å…å°¾éƒ¨â€œå˜¶å˜¶â€å¤ªé•¿
      data[i] = (Math.random()*2 - 1) * (1 - i/data.length) * breath;
    }
    noise.buffer = noiseBuf;
    const nFilter = ctx.createBiquadFilter();
    nFilter.type = 'bandpass'; nFilter.frequency.value = (F1+F2)/2; nFilter.Q.value = 0.6;
    const nGain = ctx.createGain(); nGain.gain.value = 0.15;

    // è¿æ¥
    oscPulse.connect(bp1); oscPulse.connect(bp2);
    oscSaw.connect(bp1);   oscSaw.connect(bp2);
    bp1.connect(vGain);    bp2.connect(vGain);
    lfo.connect(lfoGain);
    lfoGain.connect(oscPulse.frequency);
    lfoGain.connect(oscSaw.frequency);
    noise.connect(nFilter).connect(nGain).connect(vGain);
    vGain.connect(ctx.destination);

    // åŒ…ç»œ
    const t0 = when;
    const tEnd = when + dur;
    vGain.gain.setValueAtTime(0.0001, t0);
    vGain.gain.exponentialRampToValueAtTime(gainPeak, t0 + attack);
    vGain.gain.exponentialRampToValueAtTime(gainPeak*0.7, t0 + attack + decay);
    vGain.gain.exponentialRampToValueAtTime(0.0001, tEnd + release);

    // åŸºé¢‘æ»‘è½
    oscPulse.frequency.setValueAtTime(f0Start, t0);
    oscPulse.frequency.exponentialRampToValueAtTime(f0End, tEnd);
    oscSaw.frequency.setValueAtTime(f0Start, t0);
    oscSaw.frequency.exponentialRampToValueAtTime(f0End, tEnd);

    // å¯åœ
    oscPulse.start(t0); oscSaw.start(t0); lfo.start(t0); noise.start(t0);
    oscPulse.stop(tEnd + release); oscSaw.stop(tEnd + release);
    noise.stop(tEnd); lfo.stop(tEnd + release);

    return { out:vGain, stopAt: tEnd + release };
  }

  // /g/ çš„ç¬æ—¶çˆ†ç ´ï¼ˆé«˜é¢‘çŸ­å™ªï¼‰
  function burst(when, dur=0.045){
    const ctx = audioCtx;
    const src = ctx.createBufferSource();
    const buf = ctx.createBuffer(1, Math.floor(ctx.sampleRate*dur), ctx.sampleRate);
    const d = buf.getChannelData(0);
    for(let i=0;i<d.length;i++){ d[i] = (Math.random()*2 - 1) * (1 - i/d.length); }
    src.buffer = buf;
    const hp = ctx.createBiquadFilter(); hp.type='highpass'; hp.frequency.value = 2500;
    const g = ctx.createGain(); g.gain.value = 0.25;
    src.connect(hp).connect(g).connect(ctx.destination);
    src.start(when); src.stop(when + dur);
  }

  // æ›´åƒâ€œå­¤å¯¡â€çš„ä¸¤éŸ³èŠ‚åˆæˆ
  function playGuGua(){
    if(!audioCtx) return;
    const now = audioCtx.currentTime;

    // ç¬¬ 1 éŸ³èŠ‚ï¼š/gu/ï¼ˆæ”¶å£ï¼Œä½F1ã€ä½F2ï¼ŒçŸ­ï¼‰
    // è¿‘ä¼¼ï¼šF1â‰ˆ350Hzï¼ŒF2â‰ˆ900Hzï¼›åŸºé¢‘ä» 190â†’150Hz
    const s1 = makeVowel(now + 0.02, {
      f0Start:190, f0End:150, dur:0.20, F1:350, F2:900, gainPeak:0.55, breath:0.14
    });

    // çˆ†ç ´éŸ³åœ¨å‰æ²¿ï¼ˆ/g/ï¼‰
    burst(now, 0.05);

    // ç¬¬ 2 éŸ³èŠ‚ï¼š/gua/ï¼ˆå¼ å£ï¼Œä¸Šæ‰¬å†å›è½ï¼›F1ã€F2 å‡é«˜ï¼‰
    // è¿‘ä¼¼ï¼šF1â‰ˆ800Hzï¼ŒF2â‰ˆ1400Hzï¼›åŸºé¢‘ä» 210â†’140Hzï¼ˆå…ˆç•¥å‡åé™ï¼‰
    // æˆ‘ä»¬ç”¨ä¸¤æ®µå åŠ åšâ€œä¸Šæ‰¬-ä¸‹è½â€çš„æ„Ÿè§‰
    const s2a = makeVowel(s1.stopAt - 0.08, {
      f0Start:210, f0End:180, dur:0.14, F1:650, F2:1200, gainPeak:0.6, breath:0.16
    });
    const s2b = makeVowel(s2a.stopAt - 0.02, {
      f0Start:180, f0End:140, dur:0.18, F1:800, F2:1450, gainPeak:0.62, breath:0.18
    });

    // è½»å¾®æ€»é™å¹…ï¼ˆé¿å…å åŠ è¿‡è½½ï¼‰
    const master = audioCtx.createGain();
    master.gain.value = 0.9;
    //ï¼ˆè¿™é‡Œæˆ‘ä»¬æ˜¯ç›´æ¥æŠŠæ¯ä¸ªæ®µçš„è¾“å‡ºæ¥ destination äº†ï¼›
    // å¦‚æœä½ æƒ³æ›´ä¸¥æ ¼ï¼Œå¯æŠŠä¸Šé¢ vGain.connect(ctx.destination) æ¢æˆ connect(master)ï¼Œç„¶å master -> destinationï¼‰

    // è¿”å›å¤§è‡´ç»“æŸæ—¶é—´ï¼ˆå¯ç”¨äºåç»­èŠ‚å¥ç¼–æ’ï¼‰
    return s2b.stopAt;
  }

  // ç»Ÿä¸€äº¤äº’åé¦ˆï¼šè¯´è¯ + çˆ±å¿ƒ + å‘å£°ï¼ˆè°ƒç”¨æ–°çš„ playGuGuaï¼‰
  function interactSay(text){
    ensureAudio(); speak(text); playGuGua();
  }

    /* ========== äº‹ä»¶ï¼šé’è›™ã€æŒ‰é’®ã€æœˆäº®å½©è›‹ ========== */
    frog.addEventListener('click', () => {
      clickCount++; updateCount();
      interactSay('ã€Šå­¤å¯¡ã€‹');
    });

    btnTalk.addEventListener('click', () => {
      const lines = ['ã€Šå­¤å¯¡ã€‹','å‘±~','å­¤å¯¡å­¤å¯¡~','ä¸ƒå¤•å¿«â€¦â€¦å­¤å¯¡ï¼','å‘±å‘±ï½'];
      interactSay(lines[Math.floor(Math.random()*lines.length)]);
    });

    btnHeart.addEventListener('click', () => { interactSay('æ¯”å¿ƒ~'); spawnHearts(18); });

    // ç™½å¤©/å¤œæ™šåˆ‡æ¢
    let night = true;
    btnTheme.addEventListener('click', () => {
      night = !night;
      if(!night){
        document.documentElement.style.setProperty('--bg1','#e2f3ff');
        document.documentElement.style.setProperty('--bg2','#bfe2ff');
        document.documentElement.style.setProperty('--bg3','#9cc9ff');
      }else{
        document.documentElement.style.setProperty('--bg1','#0b132b');
        document.documentElement.style.setProperty('--bg2','#1c2541');
        document.documentElement.style.setProperty('--bg3','#3a506b');
      }
      interactSay('æ¢ä¸ªæ°›å›´ğŸ');
    });

    // æœˆäº®å½©è›‹ï¼šå˜çˆ±å¿ƒ 3 ç§’åæ¢å¤ï¼ŒåŒæ—¶å‘å£°
    let moonTimer = null;
    moon.addEventListener('click', () => {
      interactSay('æœˆäº®å˜å¿ƒâ¤ï¸');
      moon.classList.add('heart');
      clearTimeout(moonTimer);
      moonTimer = setTimeout(()=> moon.classList.remove('heart'), 3000);
      // åœ¨æœˆäº®é™„è¿‘æ’’çˆ±å¿ƒ
      spawnHearts(12);
    });

    // åˆå§‹åŒ–å°å½©è›‹
    setTimeout(()=> spawnHearts(10), 600);
  </script>
</body>
</html>
